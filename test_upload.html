<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‚¬ì—…ìë“±ë¡ì¦ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-2xl mx-auto bg-white rounded-xl shadow-lg p-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">ğŸ§ª ì‚¬ì—…ìë“±ë¡ì¦ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸</h1>
        
        <div class="mb-6">
            <label class="block text-sm font-bold text-gray-700 mb-2">íšŒì‚¬ëª…</label>
            <input id="companyName" type="text" class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-blue-500 focus:outline-none" placeholder="í…ŒìŠ¤íŠ¸ íšŒì‚¬" value="í…ŒìŠ¤íŠ¸ íšŒì‚¬">
        </div>
        
        <div class="mb-6">
            <label class="block text-sm font-bold text-gray-700 mb-2">ì‚¬ì—…ìë“±ë¡ì¦ íŒŒì¼</label>
            <input id="fileInput" type="file" accept="image/*,.pdf" class="w-full border-2 border-gray-300 rounded-lg px-4 py-2">
        </div>
        
        <button id="uploadBtn" class="w-full bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition-all">
            ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸
        </button>
        
        <div id="result" class="mt-6 p-4 rounded-lg hidden"></div>
        <div id="preview" class="mt-6"></div>
    </div>
    
    <script>
        document.getElementById('uploadBtn').addEventListener('click', async () => {
            const companyName = document.getElementById('companyName').value;
            const fileInput = document.getElementById('fileInput');
            const resultDiv = document.getElementById('result');
            const previewDiv = document.getElementById('preview');
            
            if (!fileInput.files || !fileInput.files[0]) {
                resultDiv.className = 'mt-6 p-4 rounded-lg bg-red-100 border border-red-300 text-red-700';
                resultDiv.textContent = 'âŒ íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”';
                resultDiv.classList.remove('hidden');
                return;
            }
            
            const file = fileInput.files[0];
            
            // íŒŒì¼ í¬ê¸° ì²´í¬
            if (file.size > 10 * 1024 * 1024) {
                resultDiv.className = 'mt-6 p-4 rounded-lg bg-red-100 border border-red-300 text-red-700';
                resultDiv.textContent = 'âŒ íŒŒì¼ í¬ê¸°ëŠ” 10MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤';
                resultDiv.classList.remove('hidden');
                return;
            }
            
            resultDiv.className = 'mt-6 p-4 rounded-lg bg-blue-100 border border-blue-300 text-blue-700';
            resultDiv.textContent = 'â³ íŒŒì¼ ì—…ë¡œë“œ ì¤‘...';
            resultDiv.classList.remove('hidden');
            
            try {
                // Base64ë¡œ ë³€í™˜
                const reader = new FileReader();
                reader.onload = async (event) => {
                    const base64 = event.target.result.split(',')[1];
                    
                    // Contact ê°ì²´ ìƒì„±
                    const contact = {
                        id: 'test-' + Date.now(),
                        category: 'GEOSANG',
                        brandName: companyName,
                        industry: 'í…ŒìŠ¤íŠ¸',
                        address: '',
                        phone: '',
                        email: '',
                        homepage: '',
                        licenseFile: {
                            data: base64,
                            name: file.name,
                            mimeType: file.type
                        },
                        staffList: []
                    };
                    
                    console.log('ğŸ“¤ Sending contact with license file:', contact);
                    
                    // API í˜¸ì¶œ
                    const response = await fetch('/api/contacts', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(contact)
                    });
                    
                    const result = await response.json();
                    console.log('ğŸ“¥ Response:', result);
                    
                    if (result.success) {
                        resultDiv.className = 'mt-6 p-4 rounded-lg bg-green-100 border border-green-300 text-green-700';
                        resultDiv.innerHTML = `âœ… ì—…ë¡œë“œ ì„±ê³µ!<br><br>` +
                            `<strong>íšŒì‚¬ëª…:</strong> ${companyName}<br>` +
                            `<strong>íŒŒì¼ëª…:</strong> ${file.name}<br>` +
                            `<strong>íŒŒì¼í¬ê¸°:</strong> ${(file.size / 1024).toFixed(2)} KB<br>` +
                            `<strong>Contact ID:</strong> ${result.data.id}`;
                        
                        // ë¯¸ë¦¬ë³´ê¸° (ì´ë¯¸ì§€ë§Œ)
                        if (file.type.startsWith('image/')) {
                            const img = document.createElement('img');
                            img.src = event.target.result;
                            img.className = 'w-full rounded-lg border border-gray-300 mt-4';
                            previewDiv.innerHTML = '<p class="font-bold text-gray-700 mb-2">ğŸ“¸ ë¯¸ë¦¬ë³´ê¸°:</p>';
                            previewDiv.appendChild(img);
                        }
                    } else {
                        resultDiv.className = 'mt-6 p-4 rounded-lg bg-red-100 border border-red-300 text-red-700';
                        resultDiv.textContent = 'âŒ ì—…ë¡œë“œ ì‹¤íŒ¨: ' + (result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜');
                    }
                };
                
                reader.onerror = () => {
                    resultDiv.className = 'mt-6 p-4 rounded-lg bg-red-100 border border-red-300 text-red-700';
                    resultDiv.textContent = 'âŒ íŒŒì¼ ì½ê¸° ì‹¤íŒ¨';
                };
                
                reader.readAsDataURL(file);
                
            } catch (error) {
                console.error('Upload error:', error);
                resultDiv.className = 'mt-6 p-4 rounded-lg bg-red-100 border border-red-300 text-red-700';
                resultDiv.textContent = 'âŒ ì˜¤ë¥˜: ' + error.message;
            }
        });
    </script>
</body>
</html>
